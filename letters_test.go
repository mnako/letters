package letters_test

import (
	"net/mail"
	"os"
	"reflect"
	"strings"
	"testing"
	"time"

	"github.com/mnako/letters"
)

type emailTestCase struct {
	name          string
	filepath      string
	emailParser   *letters.EmailParser
	expectedEmail letters.Email
}

func testEmailHeadersFromFile(t *testing.T, fp string, expectedEmailHeaders letters.Headers) {
	t.Helper()

	rawEmail, err := os.Open(fp)
	if err != nil {
		t.Errorf("error while reading email from file: %s", err)
		return
	}

	msg, err := mail.ReadMessage(rawEmail)
	if err != nil {
		t.Errorf("error while reading message from file: %s", err)
		return
	}

	parsedEmailHeaders, err := letters.ParseHeaders(msg.Header)
	if err != nil {
		t.Errorf("error while parsing email headers: %s", err)
		return
	}

	if !reflect.DeepEqual(parsedEmailHeaders, expectedEmailHeaders) {
		t.Errorf("email headers are not equal")
		t.Errorf("Got %#v", parsedEmailHeaders)
		t.Errorf("Want %#v", expectedEmailHeaders)
	}
}

func testEmailCases(t *testing.T, tcs []emailTestCase) {
	t.Helper()

	for _, tc := range tcs {
		testCase := tc

		t.Run(testCase.name, func(t *testing.T) {
			t.Parallel()

			rawEmail, err := os.Open(testCase.filepath)
			if err != nil {
				t.Errorf("error while reading email from file: %s", err)
				return
			}

			defer func() {
				if err := rawEmail.Close(); err != nil {
					t.Errorf("error while closing rawEmail: %s", err)
					return
				}
			}()

			parsedEmail, err := testCase.emailParser.ParseEmail(rawEmail)
			if err != nil {
				t.Errorf("error while parsing email: %s", err)
				return
			}

			if !reflect.DeepEqual(parsedEmail, testCase.expectedEmail) {
				t.Errorf("emails are not equal")
				t.Errorf("Got  %#v", parsedEmail)
				t.Errorf("Want %#v", testCase.expectedEmail)
			}
		})
	}
}

func TestParseEmailEnglishEmpty(t *testing.T) {
	t.Parallel()

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_empty.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params:      map[string]string{},
					},
					ExtraHeaders: map[string][]string{},
				},
				Text: `While this email is undeliverable, this test case makes sure that the
parser does not crash, most fields are nullable, and the rest has sane
defaults (e.g. text/plain Content-Type).`,
			},
		},
		{
			name:        "NoFilesParser",
			filepath:    "tests/test_english_empty.txt",
			emailParser: letters.NewEmailParser(letters.WithFileFilter(letters.NoFiles)),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params:      map[string]string{},
					},
					ExtraHeaders: map[string][]string{},
				},
				Text: `While this email is undeliverable, this test case makes sure that the
parser does not crash, most fields are nullable, and the rest has sane
defaults (e.g. text/plain Content-Type).`,
			},
		},
		{
			name:     "NoBodiesNoFilesParser",
			filepath: "tests/test_english_empty.txt",
			emailParser: letters.NewEmailParser(
				letters.WithBodyFilter(letters.NoBodies),
				letters.WithFileFilter(letters.NoFiles),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params:      map[string]string{},
					},
					ExtraHeaders: map[string][]string{},
				},
				Text:          "",
				EnrichedText:  "",
				HTML:          "",
				InlineFiles:   []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile(nil),
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishNoTextContent(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_no_text_content.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "Test No Text Content, Attachment Only",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID: "Message-Id-1@example.com",
					ContentType: letters.ContentTypeHeader{
						ContentType: "application/pdf",
						Params: map[string]string{
							"name": "attached-pdf-name.pdf",
						},
					},
					ContentDisposition: letters.ContentDispositionHeader{
						ContentDisposition: letters.ContentDispositionAttachment,
						Params: map[string]string{
							"filename": "attached-pdf-filename.pdf",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text:         "",
				EnrichedText: "",
				HTML:         "",
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailHeadersEnglishPlaintextAsciiOver7bit(t *testing.T) {
	t.Parallel()

	fp := "tests/test_english_plaintext_ascii_over_7bit.txt"
	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)
	expectedEmailHeaders := letters.Headers{
		Date:    expectedDate,
		Subject: "ðŸ“§ Test English Pangrams",
		ReplyTo: []*mail.Address{
			{
				Name:    "Alice Sender",
				Address: "alice.sender@example.net",
			},
		},
		Sender: &mail.Address{
			Name:    "Alice Sender",
			Address: "alice.sender@example.com",
		},
		From: []*mail.Address{
			{
				Name:    "Alice Sender",
				Address: "alice.sender@example.com",
			},
			{
				Name:    "Alice Sender",
				Address: "alice.sender@example.net",
			},
		},
		To: []*mail.Address{
			{
				Name:    "Bob Recipient",
				Address: "bob.recipient@example.com",
			},
			{
				Name:    "Carol Recipient",
				Address: "carol.recipient@example.com",
			},
		},
		Cc: []*mail.Address{
			{
				Name:    "Dan Recipient",
				Address: "dan.recipient@example.com",
			},
			{
				Name:    "Eve Recipient",
				Address: "eve.recipient@example.com",
			},
		},
		Bcc: []*mail.Address{
			{
				Name:    "Frank Recipient",
				Address: "frank.recipient@example.com",
			},
			{
				Name:    "Grace Recipient",
				Address: "grace.recipient@example.com",
			},
		},
		MessageID:  "Message-Id-1@example.com",
		InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
		References: []letters.MessageId{"Message-Id-0@example.com"},
		Comments:   "Message Header Comment",
		Keywords:   []string{"Keyword 1", "Keyword 2"},
		ContentType: letters.ContentTypeHeader{
			ContentType: "text/plain",
			Params: map[string]string{
				"charset": "ascii",
			},
		},
		ExtraHeaders: map[string][]string{
			"X-Clacks-Overhead": {"GNU Terry Pratchett"},
			"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
				"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
				"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
			},
		},
	}

	testEmailHeadersFromFile(t, fp, expectedEmailHeaders)
}

func TestParseEmailEnglishPlaintextAsciiOver7bit(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_plaintext_ascii_over_7bit.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "ascii",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishPlaintextAsciiOverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_plaintext_ascii_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "ascii",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishPlaintextAsciiOverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_plaintext_ascii_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "ascii",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishPlaintextUtf8Over7bit(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_plaintext_utf-8_over_7bit.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishPlaintextUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_plaintext_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishPlaintextUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_plaintext_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishMultipartRelatedAsciiOver7bit(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_multipart_related_ascii_over_7bit.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "ascii",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				EnrichedText: `<bold>The quick brown fox jumps over a lazy dog.</bold>
<italic>Glib jocks quiz nymph to vex dwarf.</italic>
<fixed>Sphinx of black quartz, judge my vow.</fixed>
<underline>How vexingly quick daft zebras jump!</underline>
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				HTML: `<html>
<div dir="ltr">
<p>The quick brown fox jumps over a lazy dog.</p>
<p>Glib jocks quiz nymph to vex dwarf.</p>
<p>Sphinx of black quartz, judge my vow.</p>
<p>How vexingly quick daft zebras jump!</p>
<p>The five boxing wizards jump quickly.</p>
<p>Jackdaws love my big sphinx of quartz.</p>
<p>Pack my box with five dozen liquor jugs.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishMultipartRelatedAsciiOverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_multipart_related_ascii_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "ascii",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				EnrichedText: `<bold>The quick brown fox jumps over a lazy dog.</bold>
<italic>Glib jocks quiz nymph to vex dwarf.</italic>
<fixed>Sphinx of black quartz, judge my vow.</fixed>
<underline>How vexingly quick daft zebras jump!</underline>
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				HTML: `<html>
<div dir="ltr">
<p>The quick brown fox jumps over a lazy dog.</p>
<p>Glib jocks quiz nymph to vex dwarf.</p>
<p>Sphinx of black quartz, judge my vow.</p>
<p>How vexingly quick daft zebras jump!</p>
<p>The five boxing wizards jump quickly.</p>
<p>Jackdaws love my big sphinx of quartz.</p>
<p>Pack my box with five dozen liquor jugs.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishMultipartRelatedAsciiOverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_multipart_related_ascii_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "ascii",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				EnrichedText: `<bold>The quick brown fox jumps over a lazy dog.</bold>
<italic>Glib jocks quiz nymph to vex dwarf.</italic>
<fixed>Sphinx of black quartz, judge my vow.</fixed>
<underline>How vexingly quick daft zebras jump!</underline>
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				HTML: `<html>
<div dir="ltr">
<p>The quick brown fox jumps over a lazy dog.</p>
<p>Glib jocks quiz nymph to vex dwarf.</p>
<p>Sphinx of black quartz, judge my vow.</p>
<p>How vexingly quick daft zebras jump!</p>
<p>The five boxing wizards jump quickly.</p>
<p>Jackdaws love my big sphinx of quartz.</p>
<p>Pack my box with five dozen liquor jugs.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishMultipartRelatedUtf8Over7bit(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_multipart_related_utf-8_over_7bit.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				EnrichedText: `<bold>The quick brown fox jumps over a lazy dog.</bold>
<italic>Glib jocks quiz nymph to vex dwarf.</italic>
<fixed>Sphinx of black quartz, judge my vow.</fixed>
<underline>How vexingly quick daft zebras jump!</underline>
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				HTML: `<html>
<div dir="ltr">
<p>The quick brown fox jumps over a lazy dog.</p>
<p>Glib jocks quiz nymph to vex dwarf.</p>
<p>Sphinx of black quartz, judge my vow.</p>
<p>How vexingly quick daft zebras jump!</p>
<p>The five boxing wizards jump quickly.</p>
<p>Jackdaws love my big sphinx of quartz.</p>
<p>Pack my box with five dozen liquor jugs.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishMultipartRelatedUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_multipart_related_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				EnrichedText: `<bold>The quick brown fox jumps over a lazy dog.</bold>
<italic>Glib jocks quiz nymph to vex dwarf.</italic>
<fixed>Sphinx of black quartz, judge my vow.</fixed>
<underline>How vexingly quick daft zebras jump!</underline>
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				HTML: `<html>
<div dir="ltr">
<p>The quick brown fox jumps over a lazy dog.</p>
<p>Glib jocks quiz nymph to vex dwarf.</p>
<p>Sphinx of black quartz, judge my vow.</p>
<p>How vexingly quick daft zebras jump!</p>
<p>The five boxing wizards jump quickly.</p>
<p>Jackdaws love my big sphinx of quartz.</p>
<p>Pack my box with five dozen liquor jugs.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishMultipartRelatedUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_multipart_related_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				EnrichedText: `<bold>The quick brown fox jumps over a lazy dog.</bold>
<italic>Glib jocks quiz nymph to vex dwarf.</italic>
<fixed>Sphinx of black quartz, judge my vow.</fixed>
<underline>How vexingly quick daft zebras jump!</underline>
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				HTML: `<html>
<div dir="ltr">
<p>The quick brown fox jumps over a lazy dog.</p>
<p>Glib jocks quiz nymph to vex dwarf.</p>
<p>Sphinx of black quartz, judge my vow.</p>
<p>How vexingly quick daft zebras jump!</p>
<p>The five boxing wizards jump quickly.</p>
<p>Jackdaws love my big sphinx of quartz.</p>
<p>Pack my box with five dozen liquor jugs.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishMultipartMixedAsciiOver7bit(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_multipart_mixed_ascii_over_7bit.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "ascii",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				EnrichedText: `<bold>The quick brown fox jumps over a lazy dog.</bold>
<italic>Glib jocks quiz nymph to vex dwarf.</italic>
<fixed>Sphinx of black quartz, judge my vow.</fixed>
<underline>How vexingly quick daft zebras jump!</underline>
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				HTML: `<html>
<div dir="ltr">
<p>The quick brown fox jumps over a lazy dog.</p>
<p>Glib jocks quiz nymph to vex dwarf.</p>
<p>Sphinx of black quartz, judge my vow.</p>
<p>How vexingly quick daft zebras jump!</p>
<p>The five boxing wizards jump quickly.</p>
<p>Jackdaws love my big sphinx of quartz.</p>
<p>Pack my box with five dozen liquor jugs.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_english_multipart_mixed_ascii_over_7bit.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "ascii",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				EnrichedText: `<bold>The quick brown fox jumps over a lazy dog.</bold>
<italic>Glib jocks quiz nymph to vex dwarf.</italic>
<fixed>Sphinx of black quartz, judge my vow.</fixed>
<underline>How vexingly quick daft zebras jump!</underline>
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				HTML: `<html>
<div dir="ltr">
<p>The quick brown fox jumps over a lazy dog.</p>
<p>Glib jocks quiz nymph to vex dwarf.</p>
<p>Sphinx of black quartz, judge my vow.</p>
<p>How vexingly quick daft zebras jump!</p>
<p>The five boxing wizards jump quickly.</p>
<p>Jackdaws love my big sphinx of quartz.</p>
<p>Pack my box with five dozen liquor jugs.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishMultipartMixedAsciiOverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_multipart_mixed_ascii_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "ascii",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				EnrichedText: `<bold>The quick brown fox jumps over a lazy dog.</bold>
<italic>Glib jocks quiz nymph to vex dwarf.</italic>
<fixed>Sphinx of black quartz, judge my vow.</fixed>
<underline>How vexingly quick daft zebras jump!</underline>
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				HTML: `<html>
<div dir="ltr">
<p>The quick brown fox jumps over a lazy dog.</p>
<p>Glib jocks quiz nymph to vex dwarf.</p>
<p>Sphinx of black quartz, judge my vow.</p>
<p>How vexingly quick daft zebras jump!</p>
<p>The five boxing wizards jump quickly.</p>
<p>Jackdaws love my big sphinx of quartz.</p>
<p>Pack my box with five dozen liquor jugs.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_english_multipart_mixed_ascii_over_base64.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "ascii",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				EnrichedText: `<bold>The quick brown fox jumps over a lazy dog.</bold>
<italic>Glib jocks quiz nymph to vex dwarf.</italic>
<fixed>Sphinx of black quartz, judge my vow.</fixed>
<underline>How vexingly quick daft zebras jump!</underline>
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				HTML: `<html>
<div dir="ltr">
<p>The quick brown fox jumps over a lazy dog.</p>
<p>Glib jocks quiz nymph to vex dwarf.</p>
<p>Sphinx of black quartz, judge my vow.</p>
<p>How vexingly quick daft zebras jump!</p>
<p>The five boxing wizards jump quickly.</p>
<p>Jackdaws love my big sphinx of quartz.</p>
<p>Pack my box with five dozen liquor jugs.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishMultipartMixedAsciiOverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_multipart_mixed_ascii_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "ascii",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				EnrichedText: `<bold>The quick brown fox jumps over a lazy dog.</bold>
<italic>Glib jocks quiz nymph to vex dwarf.</italic>
<fixed>Sphinx of black quartz, judge my vow.</fixed>
<underline>How vexingly quick daft zebras jump!</underline>
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				HTML: `<html>
<div dir="ltr">
<p>The quick brown fox jumps over a lazy dog.</p>
<p>Glib jocks quiz nymph to vex dwarf.</p>
<p>Sphinx of black quartz, judge my vow.</p>
<p>How vexingly quick daft zebras jump!</p>
<p>The five boxing wizards jump quickly.</p>
<p>Jackdaws love my big sphinx of quartz.</p>
<p>Pack my box with five dozen liquor jugs.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_english_multipart_mixed_ascii_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "ascii",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				EnrichedText: `<bold>The quick brown fox jumps over a lazy dog.</bold>
<italic>Glib jocks quiz nymph to vex dwarf.</italic>
<fixed>Sphinx of black quartz, judge my vow.</fixed>
<underline>How vexingly quick daft zebras jump!</underline>
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				HTML: `<html>
<div dir="ltr">
<p>The quick brown fox jumps over a lazy dog.</p>
<p>Glib jocks quiz nymph to vex dwarf.</p>
<p>Sphinx of black quartz, judge my vow.</p>
<p>How vexingly quick daft zebras jump!</p>
<p>The five boxing wizards jump quickly.</p>
<p>Jackdaws love my big sphinx of quartz.</p>
<p>Pack my box with five dozen liquor jugs.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishMultipartMixedUtf8Over7bit(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_multipart_mixed_utf-8_over_7bit.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				EnrichedText: `<bold>The quick brown fox jumps over a lazy dog.</bold>
<italic>Glib jocks quiz nymph to vex dwarf.</italic>
<fixed>Sphinx of black quartz, judge my vow.</fixed>
<underline>How vexingly quick daft zebras jump!</underline>
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				HTML: `<html>
<div dir="ltr">
<p>The quick brown fox jumps over a lazy dog.</p>
<p>Glib jocks quiz nymph to vex dwarf.</p>
<p>Sphinx of black quartz, judge my vow.</p>
<p>How vexingly quick daft zebras jump!</p>
<p>The five boxing wizards jump quickly.</p>
<p>Jackdaws love my big sphinx of quartz.</p>
<p>Pack my box with five dozen liquor jugs.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_english_multipart_mixed_utf-8_over_7bit.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				EnrichedText: `<bold>The quick brown fox jumps over a lazy dog.</bold>
<italic>Glib jocks quiz nymph to vex dwarf.</italic>
<fixed>Sphinx of black quartz, judge my vow.</fixed>
<underline>How vexingly quick daft zebras jump!</underline>
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				HTML: `<html>
<div dir="ltr">
<p>The quick brown fox jumps over a lazy dog.</p>
<p>Glib jocks quiz nymph to vex dwarf.</p>
<p>Sphinx of black quartz, judge my vow.</p>
<p>How vexingly quick daft zebras jump!</p>
<p>The five boxing wizards jump quickly.</p>
<p>Jackdaws love my big sphinx of quartz.</p>
<p>Pack my box with five dozen liquor jugs.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishMultipartMixedUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_multipart_mixed_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				EnrichedText: `<bold>The quick brown fox jumps over a lazy dog.</bold>
<italic>Glib jocks quiz nymph to vex dwarf.</italic>
<fixed>Sphinx of black quartz, judge my vow.</fixed>
<underline>How vexingly quick daft zebras jump!</underline>
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				HTML: `<html>
<div dir="ltr">
<p>The quick brown fox jumps over a lazy dog.</p>
<p>Glib jocks quiz nymph to vex dwarf.</p>
<p>Sphinx of black quartz, judge my vow.</p>
<p>How vexingly quick daft zebras jump!</p>
<p>The five boxing wizards jump quickly.</p>
<p>Jackdaws love my big sphinx of quartz.</p>
<p>Pack my box with five dozen liquor jugs.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_english_multipart_mixed_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				EnrichedText: `<bold>The quick brown fox jumps over a lazy dog.</bold>
<italic>Glib jocks quiz nymph to vex dwarf.</italic>
<fixed>Sphinx of black quartz, judge my vow.</fixed>
<underline>How vexingly quick daft zebras jump!</underline>
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				HTML: `<html>
<div dir="ltr">
<p>The quick brown fox jumps over a lazy dog.</p>
<p>Glib jocks quiz nymph to vex dwarf.</p>
<p>Sphinx of black quartz, judge my vow.</p>
<p>How vexingly quick daft zebras jump!</p>
<p>The five boxing wizards jump quickly.</p>
<p>Jackdaws love my big sphinx of quartz.</p>
<p>Pack my box with five dozen liquor jugs.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishMultipartMixedUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_multipart_mixed_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				EnrichedText: `<bold>The quick brown fox jumps over a lazy dog.</bold>
<italic>Glib jocks quiz nymph to vex dwarf.</italic>
<fixed>Sphinx of black quartz, judge my vow.</fixed>
<underline>How vexingly quick daft zebras jump!</underline>
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				HTML: `<html>
<div dir="ltr">
<p>The quick brown fox jumps over a lazy dog.</p>
<p>Glib jocks quiz nymph to vex dwarf.</p>
<p>Sphinx of black quartz, judge my vow.</p>
<p>How vexingly quick daft zebras jump!</p>
<p>The five boxing wizards jump quickly.</p>
<p>Jackdaws love my big sphinx of quartz.</p>
<p>Pack my box with five dozen liquor jugs.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_english_multipart_mixed_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				EnrichedText: `<bold>The quick brown fox jumps over a lazy dog.</bold>
<italic>Glib jocks quiz nymph to vex dwarf.</italic>
<fixed>Sphinx of black quartz, judge my vow.</fixed>
<underline>How vexingly quick daft zebras jump!</underline>
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				HTML: `<html>
<div dir="ltr">
<p>The quick brown fox jumps over a lazy dog.</p>
<p>Glib jocks quiz nymph to vex dwarf.</p>
<p>Sphinx of black quartz, judge my vow.</p>
<p>How vexingly quick daft zebras jump!</p>
<p>The five boxing wizards jump quickly.</p>
<p>Jackdaws love my big sphinx of quartz.</p>
<p>Pack my box with five dozen liquor jugs.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishMultipartSignedAsciiOver7bit(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_multipart_signed_ascii_over_7bit.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "ascii",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishMultipartSignedAsciiOverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_multipart_signed_ascii_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "ascii",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishMultipartSignedAsciiOverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_multipart_signed_ascii_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "ascii",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishMultipartSignedUtf8Over7bit(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_multipart_signed_utf-8_over_7bit.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "utf-8",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishMultipartSignedUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_multipart_signed_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "utf-8",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailEnglishMultipartSignedUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/London")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_english_multipart_signed_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test English Pangrams",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.com",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.com",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.com",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.net",
						},
						{
							Name:    "Alice Sender",
							Address: "alice.sender@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice Sender",
						Address: "alice.sender@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Recipient",
							Address: "bob.recipient@example.net",
						},
						{
							Name:    "Carol Recipient",
							Address: "carol.recipient@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Recipient",
							Address: "dan.recipient@example.net",
						},
						{
							Name:    "Eve Recipient",
							Address: "eve.recipient@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Recipient",
							Address: "frank.recipient@example.net",
						},
						{
							Name:    "Grace Recipient",
							Address: "grace.recipient@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "utf-8",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `The quick brown fox jumps over a lazy dog.
Glib jocks quiz nymph to vex dwarf.
Sphinx of black quartz, judge my vow.
How vexingly quick daft zebras jump!
The five boxing wizards jump quickly.
Jackdaws love my big sphinx of quartz.
Pack my box with five dozen liquor jugs.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailChinesePlaintextGb18030OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Shanghai")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_chinese_plaintext_gb18030_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test æ–½æ°é£Ÿç‹®å²",
					ReplyTo: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.com",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.com",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.com",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.net",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.net",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.net",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "gb18030",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailChinesePlaintextGb18030OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Shanghai")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_chinese_plaintext_gb18030_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test æ–½æ°é£Ÿç‹®å²",
					ReplyTo: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.com",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.com",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.com",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.net",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.net",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.net",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "gb18030",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailChinesePlaintextGbkOverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Shanghai")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_chinese_plaintext_gbk_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test æ–½æ°é£Ÿç‹®å²",
					ReplyTo: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.com",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.com",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.com",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.net",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.net",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.net",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "gbk",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailChinesePlaintextGbkOverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Shanghai")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_chinese_plaintext_gbk_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test æ–½æ°é£Ÿç‹®å²",
					ReplyTo: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.com",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.com",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.com",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.net",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.net",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.net",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "gbk",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailChineseMultipartRelatedGb18030OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Shanghai")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_chinese_multipart_related_gb18030_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test æ–½æ°é£Ÿç‹®å²",
					ReplyTo: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.com",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.com",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.com",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.net",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.net",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.net",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "gb18030",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				EnrichedText: `<bold>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚</bold>
<italic>æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚</italic>
<fixed>åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚</fixed>
<underline>æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚</underline>
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚<br />
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚<br />
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚<br />
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚<br />
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚<br />
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚<br />
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚<br />
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚<br />
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚<br />
è¯•é‡Šæ˜¯äº‹ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailChineseMultipartRelatedGb18030OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Shanghai")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_chinese_multipart_related_gb18030_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test æ–½æ°é£Ÿç‹®å²",
					ReplyTo: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.com",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.com",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.com",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.net",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.net",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.net",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "gb18030",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				EnrichedText: `<bold>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚</bold>
<italic>æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚</italic>
<fixed>åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚</fixed>
<underline>æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚</underline>
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚<br />
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚<br />
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚<br />
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚<br />
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚<br />
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚<br />
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚<br />
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚<br />
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚<br />
è¯•é‡Šæ˜¯äº‹ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailChineseMultipartRelatedGbkOverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Shanghai")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_chinese_multipart_related_gbk_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test æ–½æ°é£Ÿç‹®å²",
					ReplyTo: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.com",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.com",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.com",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.net",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.net",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.net",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "gbk",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				EnrichedText: `<bold>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚</bold>
<italic>æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚</italic>
<fixed>åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚</fixed>
<underline>æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚</underline>
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚<br />
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚<br />
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚<br />
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚<br />
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚<br />
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚<br />
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚<br />
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚<br />
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚<br />
è¯•é‡Šæ˜¯äº‹ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailChineseMultipartRelatedGbkOverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Shanghai")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_chinese_multipart_related_gbk_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test æ–½æ°é£Ÿç‹®å²",
					ReplyTo: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.com",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.com",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.com",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.net",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.net",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.net",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "gbk",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				EnrichedText: `<bold>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚</bold>
<italic>æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚</italic>
<fixed>åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚</fixed>
<underline>æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚</underline>
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚<br />
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚<br />
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚<br />
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚<br />
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚<br />
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚<br />
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚<br />
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚<br />
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚<br />
è¯•é‡Šæ˜¯äº‹ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailChineseMultipartMixedGb18030OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Shanghai")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_chinese_multipart_mixed_gb18030_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test æ–½æ°é£Ÿç‹®å²",
					ReplyTo: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.com",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.com",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.com",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.net",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.net",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.net",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "gb18030",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				EnrichedText: `<bold>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚</bold>
<italic>æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚</italic>
<fixed>åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚</fixed>
<underline>æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚</underline>
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚<br />
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚<br />
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚<br />
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚<br />
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚<br />
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚<br />
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚<br />
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚<br />
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚<br />
è¯•é‡Šæ˜¯äº‹ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_chinese_multipart_mixed_gb18030_over_base64.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test æ–½æ°é£Ÿç‹®å²",
					ReplyTo: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.com",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.com",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.com",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.net",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.net",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.net",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "gb18030",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				EnrichedText: `<bold>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚</bold>
<italic>æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚</italic>
<fixed>åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚</fixed>
<underline>æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚</underline>
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚<br />
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚<br />
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚<br />
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚<br />
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚<br />
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚<br />
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚<br />
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚<br />
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚<br />
è¯•é‡Šæ˜¯äº‹ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailChineseMultipartMixedGb18030OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Shanghai")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_chinese_multipart_mixed_gb18030_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test æ–½æ°é£Ÿç‹®å²",
					ReplyTo: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.com",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.com",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.com",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.net",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.net",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.net",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "gb18030",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				EnrichedText: `<bold>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚</bold>
<italic>æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚</italic>
<fixed>åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚</fixed>
<underline>æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚</underline>
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚<br />
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚<br />
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚<br />
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚<br />
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚<br />
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚<br />
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚<br />
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚<br />
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚<br />
è¯•é‡Šæ˜¯äº‹ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_chinese_multipart_mixed_gb18030_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test æ–½æ°é£Ÿç‹®å²",
					ReplyTo: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.com",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.com",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.com",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.net",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.net",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.net",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "gb18030",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				EnrichedText: `<bold>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚</bold>
<italic>æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚</italic>
<fixed>åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚</fixed>
<underline>æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚</underline>
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚<br />
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚<br />
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚<br />
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚<br />
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚<br />
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚<br />
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚<br />
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚<br />
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚<br />
è¯•é‡Šæ˜¯äº‹ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailChineseMultipartMixedGbkOverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Shanghai")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_chinese_multipart_mixed_gbk_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test æ–½æ°é£Ÿç‹®å²",
					ReplyTo: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.com",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.com",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.com",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.net",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.net",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.net",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "gbk",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				EnrichedText: `<bold>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚</bold>
<italic>æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚</italic>
<fixed>åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚</fixed>
<underline>æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚</underline>
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚<br />
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚<br />
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚<br />
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚<br />
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚<br />
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚<br />
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚<br />
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚<br />
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚<br />
è¯•é‡Šæ˜¯äº‹ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_chinese_multipart_mixed_gbk_over_base64.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test æ–½æ°é£Ÿç‹®å²",
					ReplyTo: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.com",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.com",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.com",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.net",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.net",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.net",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "gbk",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				EnrichedText: `<bold>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚</bold>
<italic>æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚</italic>
<fixed>åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚</fixed>
<underline>æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚</underline>
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚<br />
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚<br />
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚<br />
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚<br />
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚<br />
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚<br />
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚<br />
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚<br />
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚<br />
è¯•é‡Šæ˜¯äº‹ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailChineseMultipartMixedGbkOverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Shanghai")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_chinese_multipart_mixed_gbk_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test æ–½æ°é£Ÿç‹®å²",
					ReplyTo: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.com",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.com",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.com",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.net",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.net",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.net",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "gbk",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				EnrichedText: `<bold>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚</bold>
<italic>æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚</italic>
<fixed>åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚</fixed>
<underline>æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚</underline>
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚<br />
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚<br />
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚<br />
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚<br />
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚<br />
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚<br />
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚<br />
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚<br />
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚<br />
è¯•é‡Šæ˜¯äº‹ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_chinese_multipart_mixed_gbk_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test æ–½æ°é£Ÿç‹®å²",
					ReplyTo: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.com",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.com",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.com",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.net",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.net",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.net",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "gbk",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				EnrichedText: `<bold>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚</bold>
<italic>æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚</italic>
<fixed>åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚</fixed>
<underline>æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚</underline>
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚<br />
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚<br />
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚<br />
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚<br />
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚<br />
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚<br />
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚<br />
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚<br />
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚<br />
è¯•é‡Šæ˜¯äº‹ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailChineseMultipartSignedGb18030OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Shanghai")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_chinese_multipart_signed_gb18030_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test æ–½æ°é£Ÿç‹®å²",
					ReplyTo: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.com",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.com",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.com",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.net",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.net",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.net",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "gb18030",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailChineseMultipartSignedGb18030OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Shanghai")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_chinese_multipart_signed_gb18030_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test æ–½æ°é£Ÿç‹®å²",
					ReplyTo: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.com",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.com",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.com",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.net",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.net",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.net",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "gb18030",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailChineseMultipartSignedGbkOverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Shanghai")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_chinese_multipart_signed_gbk_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test æ–½æ°é£Ÿç‹®å²",
					ReplyTo: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.com",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.com",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.com",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.net",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.net",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.net",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "gbk",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailChineseMultipartSignedGbkOverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Shanghai")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_chinese_multipart_signed_gbk_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test æ–½æ°é£Ÿç‹®å²",
					ReplyTo: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.com",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.com",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.com",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.net",
						},
						{
							Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
							Address: "alice.fajianren@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "è‰¾èŽ‰çµ² å‘ä»¶äºº",
						Address: "alice.fajianren@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "èˆ‡é®‘ä¼¯ æ”¶ä»¶äºº",
							Address: "bob.shoujianren@example.net",
						},
						{
							Name:    "å¡ç½—å°” æ”¶ä»¶äºº",
							Address: "carol.shoujianren@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "æˆ´å¤« æ”¶ä»¶äºº",
							Address: "dave.shoujianren@example.net",
						},
						{
							Name:    "ä¼Šå¤« æ”¶ä»¶äºº",
							Address: "eve.shoujianren@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "è‰¾è¨å…‹ ä¼Šå¤«",
							Address: "isaac.shoujianren@example.net",
						},
						{
							Name:    "è³ˆæ–¯æ±€ ä¼Šå¤«",
							Address: "justin.shoujianren@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "gbk",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `çŸ³å®¤è¯—å£«æ–½æ°ï¼Œå—œç‹®ï¼Œèª“é£Ÿåç‹®ã€‚
æ°æ—¶æ—¶é€‚å¸‚è§†ç‹®ã€‚
åæ—¶ï¼Œé€‚åç‹®é€‚å¸‚ã€‚
æ˜¯æ—¶ï¼Œé€‚æ–½æ°é€‚å¸‚ã€‚
æ°è§†æ˜¯åç‹®ï¼ŒæƒçŸ¢åŠ¿ï¼Œä½¿æ˜¯åç‹®é€ä¸–ã€‚
æ°æ‹¾æ˜¯åç‹®å°¸ï¼Œé€‚çŸ³å®¤ã€‚
çŸ³å®¤æ¹¿ï¼Œæ°ä½¿ä¾æ‹­çŸ³å®¤ã€‚
çŸ³å®¤æ‹­ï¼Œæ°å§‹è¯•é£Ÿæ˜¯åç‹®ã€‚
é£Ÿæ—¶ï¼Œå§‹è¯†æ˜¯åç‹®å°¸ï¼Œå®žåçŸ³ç‹®å°¸ã€‚
è¯•é‡Šæ˜¯äº‹ã€‚`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailFinnishPlaintextUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Helsinki")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_finnish_plaintext_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Suomenkieliset pangrammit",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.com",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.com",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.net",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.net",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.
Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.
HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.
Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailFinnishPlaintextUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Helsinki")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_finnish_plaintext_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Suomenkieliset pangrammit",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.com",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.com",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.net",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.net",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.
Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.
HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.
Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailFinnishPlaintextIso885915OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Helsinki")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_finnish_plaintext_iso-8859-15_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Suomenkieliset pangrammit",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.com",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.com",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.net",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.net",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "iso-8859-15",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.
Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.
HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.
Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailFinnishPlaintextIso885915OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Helsinki")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_finnish_plaintext_iso-8859-15_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Suomenkieliset pangrammit",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.com",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.com",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.net",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.net",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "iso-8859-15",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.
Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.
HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.
Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailFinnishMultipartRelatedUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Helsinki")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_finnish_multipart_related_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Suomenkieliset pangrammit",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.com",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.com",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.net",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.net",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.
Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.
HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.
Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				EnrichedText: `<bold>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</bold>
<italic>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</italic>
<fixed>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</fixed>
<underline>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</underline>
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				HTML: `<html>
<div dir="ltr">
<p>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</p>
<p>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</p>
<p>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</p>
<p>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</p>
<p>Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.</p>
<p>WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailFinnishMultipartRelatedUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Helsinki")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_finnish_multipart_related_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Suomenkieliset pangrammit",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.com",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.com",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.net",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.net",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.
Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.
HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.
Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				EnrichedText: `<bold>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</bold>
<italic>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</italic>
<fixed>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</fixed>
<underline>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</underline>
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				HTML: `<html>
<div dir="ltr">
<p>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</p>
<p>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</p>
<p>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</p>
<p>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</p>
<p>Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.</p>
<p>WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailFinnishMultipartRelatedIso885915OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Helsinki")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_finnish_multipart_related_iso-8859-15_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Suomenkieliset pangrammit",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.com",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.com",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.net",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.net",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "iso-8859-15",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.
Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.
HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.
Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				EnrichedText: `<bold>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</bold>
<italic>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</italic>
<fixed>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</fixed>
<underline>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</underline>
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				HTML: `<html>
<div dir="ltr">
<p>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</p>
<p>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</p>
<p>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</p>
<p>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</p>
<p>Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.</p>
<p>WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailFinnishMultipartRelatedIso885915OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Helsinki")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_finnish_multipart_related_iso-8859-15_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Suomenkieliset pangrammit",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.com",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.com",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.net",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.net",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "iso-8859-15",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.
Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.
HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.
Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				EnrichedText: `<bold>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</bold>
<italic>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</italic>
<fixed>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</fixed>
<underline>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</underline>
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				HTML: `<html>
<div dir="ltr">
<p>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</p>
<p>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</p>
<p>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</p>
<p>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</p>
<p>Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.</p>
<p>WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailFinnishMultipartMixedUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Helsinki")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_finnish_multipart_mixed_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Suomenkieliset pangrammit",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.com",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.com",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.net",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.net",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.
Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.
HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.
Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				EnrichedText: `<bold>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</bold>
<italic>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</italic>
<fixed>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</fixed>
<underline>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</underline>
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				HTML: `<html>
<div dir="ltr">
<p>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</p>
<p>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</p>
<p>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</p>
<p>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</p>
<p>Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.</p>
<p>WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_finnish_multipart_mixed_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Suomenkieliset pangrammit",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.com",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.com",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.net",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.net",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.
Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.
HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.
Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				EnrichedText: `<bold>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</bold>
<italic>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</italic>
<fixed>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</fixed>
<underline>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</underline>
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				HTML: `<html>
<div dir="ltr">
<p>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</p>
<p>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</p>
<p>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</p>
<p>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</p>
<p>Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.</p>
<p>WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailFinnishMultipartMixedUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Helsinki")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_finnish_multipart_mixed_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Suomenkieliset pangrammit",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.com",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.com",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.net",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.net",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.
Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.
HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.
Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				EnrichedText: `<bold>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</bold>
<italic>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</italic>
<fixed>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</fixed>
<underline>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</underline>
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				HTML: `<html>
<div dir="ltr">
<p>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</p>
<p>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</p>
<p>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</p>
<p>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</p>
<p>Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.</p>
<p>WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_finnish_multipart_mixed_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Suomenkieliset pangrammit",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.com",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.com",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.net",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.net",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.
Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.
HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.
Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				EnrichedText: `<bold>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</bold>
<italic>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</italic>
<fixed>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</fixed>
<underline>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</underline>
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				HTML: `<html>
<div dir="ltr">
<p>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</p>
<p>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</p>
<p>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</p>
<p>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</p>
<p>Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.</p>
<p>WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailFinnishMultipartMixedIso885915OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Helsinki")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_finnish_multipart_mixed_iso-8859-15_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Suomenkieliset pangrammit",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.com",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.com",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.net",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.net",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-8859-15",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.
Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.
HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.
Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				EnrichedText: `<bold>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</bold>
<italic>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</italic>
<fixed>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</fixed>
<underline>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</underline>
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				HTML: `<html>
<div dir="ltr">
<p>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</p>
<p>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</p>
<p>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</p>
<p>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</p>
<p>Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.</p>
<p>WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_finnish_multipart_mixed_iso-8859-15_over_base64.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Suomenkieliset pangrammit",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.com",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.com",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.net",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.net",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-8859-15",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.
Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.
HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.
Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				EnrichedText: `<bold>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</bold>
<italic>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</italic>
<fixed>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</fixed>
<underline>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</underline>
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				HTML: `<html>
<div dir="ltr">
<p>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</p>
<p>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</p>
<p>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</p>
<p>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</p>
<p>Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.</p>
<p>WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailFinnishMultipartMixedIso885915OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Helsinki")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_finnish_multipart_mixed_iso-8859-15_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Suomenkieliset pangrammit",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.com",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.com",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.net",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.net",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-8859-15",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.
Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.
HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.
Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				EnrichedText: `<bold>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</bold>
<italic>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</italic>
<fixed>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</fixed>
<underline>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</underline>
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				HTML: `<html>
<div dir="ltr">
<p>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</p>
<p>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</p>
<p>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</p>
<p>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</p>
<p>Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.</p>
<p>WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_finnish_multipart_mixed_iso-8859-15_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Suomenkieliset pangrammit",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.com",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.com",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.net",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.net",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-8859-15",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.
Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.
HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.
Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				EnrichedText: `<bold>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</bold>
<italic>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</italic>
<fixed>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</fixed>
<underline>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</underline>
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				HTML: `<html>
<div dir="ltr">
<p>Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.</p>
<p>Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.</p>
<p>HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.</p>
<p>Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.</p>
<p>Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.</p>
<p>WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailFinnishMultipartSignedUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Helsinki")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_finnish_multipart_signed_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test Suomenkieliset pangrammit",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.com",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.com",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.net",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.net",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "utf-8",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.
Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.
HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.
Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailFinnishMultipartSignedUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Helsinki")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_finnish_multipart_signed_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test Suomenkieliset pangrammit",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.com",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.com",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.net",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.net",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "utf-8",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.
Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.
HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.
Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailFinnishMultipartSignedIso885915OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Helsinki")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_finnish_multipart_signed_iso-8859-15_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test Suomenkieliset pangrammit",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.com",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.com",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.net",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.net",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "iso-8859-15",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.
Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.
HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.
Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailFinnishMultipartSignedIso885915OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Helsinki")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_finnish_multipart_signed_iso-8859-15_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test Suomenkieliset pangrammit",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.com",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.com",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.net",
						},
						{
							Name:    "Alice LÃ¤hettÃ¤jÃ¤",
							Address: "alice.lahettaja@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice LÃ¤hettÃ¤jÃ¤",
						Address: "alice.lahettaja@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob Vastaanottaja",
							Address: "bob.vastaanottaja@exaple.com",
						},
						{
							Name:    "Carol Vastaanottaja",
							Address: "carol.vastaanottaja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan Vastaanottaja",
							Address: "dan.vastaanottaja@example.net",
						},
						{
							Name:    "Eve Vastaanottaja",
							Address: "eve.vastaanottaja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank Vastaanottaja",
							Address: "frank.vastaanottaja@example.net",
						},
						{
							Name:    "Grace Vastaanottaja",
							Address: "grace.vastaanottaja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "iso-8859-15",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `Albert osti fagotin ja tÃ¶rÃ¤ytti puhkuvan melodian.
Lorun sangen pieneksi hyÃ¶dyksi jÃ¤ivÃ¤t suomen kirjaimet.
HyvÃ¤n lorun sangen pieneksi hyÃ¶dyksi jÃ¤i suomen kirjaimet.
Fahrenheit ja Celsius yrjÃ¶sivÃ¤t Ã…san backgammon-peliin, Volkswagenissa, daiquirin ja ZX81:n yhteisvaikutuksesta.
Charles Darwin jammaili Ã…ken hevixylofonilla Qatarin yÃ¶pub ZeligissÃ¤.
WienilÃ¤inen sioux:ta puhuva Ã¶kyzombie diggaa Ã…san roquefort-tacoja.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailIcelandicPlaintextUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Atlantic/Reykjavik")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_icelandic_plaintext_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Ãslenskt pangram",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.com",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.com",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.com",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.net",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.net",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.net",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.
Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.
ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailIcelandicPlaintextUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Atlantic/Reykjavik")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_icelandic_plaintext_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Ãslenskt pangram",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.com",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.com",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.com",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.net",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.net",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.net",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.
Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.
ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailIcelandicPlaintextIso88591OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Atlantic/Reykjavik")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_icelandic_plaintext_iso-8859-1_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Ãslenskt pangram",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.com",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.com",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.com",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.net",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.net",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.net",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "iso-8859-1",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.
Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.
ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailIcelandicPlaintextIso88591OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Atlantic/Reykjavik")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_icelandic_plaintext_iso-8859-1_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Ãslenskt pangram",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.com",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.com",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.com",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.net",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.net",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.net",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "iso-8859-1",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.
Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.
ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailIcelandicMultipartRelatedUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Atlantic/Reykjavik")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_icelandic_multipart_related_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Ãslenskt pangram",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.com",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.com",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.com",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.net",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.net",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.net",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.
Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.
ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.`,
				EnrichedText: `<bold>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</bold>
<italic>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</italic>
<fixed>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</fixed>`,
				HTML: `<html>
<div dir="ltr">
<p>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</p>
<p>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</p>
<p>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailIcelandicMultipartRelatedUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Atlantic/Reykjavik")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_icelandic_multipart_related_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Ãslenskt pangram",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.com",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.com",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.com",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.net",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.net",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.net",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.
Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.
ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.`,
				EnrichedText: `<bold>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</bold>
<italic>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</italic>
<fixed>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</fixed>`,
				HTML: `<html>
<div dir="ltr">
<p>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</p>
<p>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</p>
<p>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailIcelandicMultipartRelatedIso88591OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Atlantic/Reykjavik")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_icelandic_multipart_related_iso-8859-1_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Ãslenskt pangram",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.com",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.com",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.com",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.net",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.net",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.net",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "iso-8859-1",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.
Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.
ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.`,
				EnrichedText: `<bold>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</bold>
<italic>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</italic>
<fixed>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</fixed>`,
				HTML: `<html>
<div dir="ltr">
<p>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</p>
<p>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</p>
<p>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailIcelandicMultipartRelatedIso88591OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Atlantic/Reykjavik")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_icelandic_multipart_related_iso-8859-1_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Ãslenskt pangram",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.com",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.com",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.com",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.net",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.net",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.net",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "iso-8859-1",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.
Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.
ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.`,
				EnrichedText: `<bold>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</bold>
<italic>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</italic>
<fixed>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</fixed>`,
				HTML: `<html>
<div dir="ltr">
<p>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</p>
<p>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</p>
<p>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailIcelandicMultipartMixedUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Atlantic/Reykjavik")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_icelandic_multipart_mixed_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Ãslenskt pangram",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.com",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.com",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.com",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.net",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.net",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.net",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.
Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.
ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.`,
				EnrichedText: `<bold>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</bold>
<italic>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</italic>
<fixed>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</fixed>`,
				HTML: `<html>
<div dir="ltr">
<p>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</p>
<p>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</p>
<p>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_icelandic_multipart_mixed_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Ãslenskt pangram",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.com",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.com",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.com",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.net",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.net",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.net",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.
Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.
ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.`,
				EnrichedText: `<bold>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</bold>
<italic>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</italic>
<fixed>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</fixed>`,
				HTML: `<html>
<div dir="ltr">
<p>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</p>
<p>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</p>
<p>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailIcelandicMultipartMixedUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Atlantic/Reykjavik")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_icelandic_multipart_mixed_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Ãslenskt pangram",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.com",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.com",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.com",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.net",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.net",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.net",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.
Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.
ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.`,
				EnrichedText: `<bold>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</bold>
<italic>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</italic>
<fixed>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</fixed>`,
				HTML: `<html>
<div dir="ltr">
<p>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</p>
<p>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</p>
<p>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_icelandic_multipart_mixed_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Ãslenskt pangram",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.com",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.com",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.com",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.net",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.net",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.net",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.
Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.
ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.`,
				EnrichedText: `<bold>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</bold>
<italic>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</italic>
<fixed>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</fixed>`,
				HTML: `<html>
<div dir="ltr">
<p>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</p>
<p>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</p>
<p>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailIcelandicMultipartMixedIso88591OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Atlantic/Reykjavik")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_icelandic_multipart_mixed_iso-8859-1_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Ãslenskt pangram",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.com",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.com",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.com",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.net",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.net",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.net",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-8859-1",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.
Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.
ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.`,
				EnrichedText: `<bold>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</bold>
<italic>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</italic>
<fixed>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</fixed>`,
				HTML: `<html>
<div dir="ltr">
<p>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</p>
<p>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</p>
<p>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_icelandic_multipart_mixed_iso-8859-1_over_base64.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Ãslenskt pangram",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.com",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.com",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.com",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.net",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.net",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.net",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-8859-1",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.
Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.
ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.`,
				EnrichedText: `<bold>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</bold>
<italic>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</italic>
<fixed>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</fixed>`,
				HTML: `<html>
<div dir="ltr">
<p>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</p>
<p>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</p>
<p>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailIcelandicMultipartMixedIso88591OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Atlantic/Reykjavik")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_icelandic_multipart_mixed_iso-8859-1_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Ãslenskt pangram",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.com",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.com",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.com",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.net",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.net",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.net",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-8859-1",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.
Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.
ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.`,
				EnrichedText: `<bold>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</bold>
<italic>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</italic>
<fixed>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</fixed>`,
				HTML: `<html>
<div dir="ltr">
<p>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</p>
<p>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</p>
<p>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_icelandic_multipart_mixed_iso-8859-1_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Ãslenskt pangram",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.com",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.com",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.com",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.net",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.net",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.net",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-8859-1",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.
Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.
ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.`,
				EnrichedText: `<bold>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</bold>
<italic>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</italic>
<fixed>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</fixed>`,
				HTML: `<html>
<div dir="ltr">
<p>KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.</p>
<p>Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.</p>
<p>ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailIcelandicMultipartSignedUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Atlantic/Reykjavik")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_icelandic_multipart_signed_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test Ãslenskt pangram",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.com",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.com",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.com",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.net",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.net",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.net",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "utf-8",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.
Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.
ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailIcelandicMultipartSignedUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Atlantic/Reykjavik")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_icelandic_multipart_signed_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test Ãslenskt pangram",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.com",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.com",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.com",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.net",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.net",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.net",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "utf-8",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.
Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.
ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailIcelandicMultipartSignedIso88591OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Atlantic/Reykjavik")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_icelandic_multipart_signed_iso-8859-1_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test Ãslenskt pangram",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.com",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.com",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.com",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.net",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.net",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.net",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "iso-8859-1",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.
Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.
ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailIcelandicMultipartSignedIso88591OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Atlantic/Reykjavik")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_icelandic_multipart_signed_iso-8859-1_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test Ãslenskt pangram",
					ReplyTo: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.com",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.com",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.com",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.net",
						},
						{
							Name:    "Alice SendandidÃ³ttir",
							Address: "alice.sendandidottir@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "Alice SendandidÃ³ttir",
						Address: "alice.sendandidottir@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "Bob ViÃ°takandison",
							Address: "bob.didtakandison@example.net",
						},
						{
							Name:    "Carol ViÃ°takandidÃ³ttir",
							Address: "carol.didtakandidottir@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "Dan ViÃ°takandison",
							Address: "dan.vidtakandison@example.net",
						},
						{
							Name:    "Eve ViÃ°takandidÃ³ttir",
							Address: "eve.vidtakandidottir@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "Frank ViÃ°takandison",
							Address: "frank.vidtakandison@example.net",
						},
						{
							Name:    "Grace ViÃ°takandidÃ³ttir",
							Address: "grace.vidtakandidottir@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "iso-8859-1",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `KÃ¦mi nÃ½ Ã¶xi hÃ©r, ykist Ã¾jÃ³fum nÃº bÃ¦Ã°i vÃ­l og Ã¡drepa.
Svo hÃ¶lt, yxna kÃ½r Ã¾egÃ°i jÃº um dÃ³p Ã­ fÃ© Ã¡ bÃ¦.
ÃžÃº dazt Ã¡ hnÃ©Ã° Ã­ vÃ¶k og yfir blÃ³m sexÃ½ pÃ¦ju.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapanesePlaintextUtf8Over7bit(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_plaintext_utf-8_over_7bit.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapanesePlaintextUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_plaintext_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapanesePlaintextUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_plaintext_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapanesePlaintextIso2022jpOver7bit(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_plaintext_iso-2022-jp_over_7bit.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "iso-2022-jp",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapanesePlaintextIso2022jpOverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_plaintext_iso-2022-jp_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "iso-2022-jp",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapanesePlaintextIso2022jpOverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_plaintext_iso-2022-jp_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "iso-2022-jp",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapanesePlaintextEucjpOverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_plaintext_euc-jp_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "euc-jp",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapanesePlaintextEucjpOverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_plaintext_euc-jp_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "euc-jp",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartRelatedUtf8Over7bit(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_related_utf-8_over_7bit.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartRelatedUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_related_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartRelatedUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_related_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartRelatedIso2022jpOver7bit(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_related_iso-2022-jp_over_7bit.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "iso-2022-jp",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartRelatedIso2022jpOverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_related_iso-2022-jp_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "iso-2022-jp",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartRelatedIso2022jpOverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_related_iso-2022-jp_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "iso-2022-jp",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartRelatedEucjpOverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_related_euc-jp_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "euc-jp",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartRelatedEucjpOverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_related_euc-jp_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "euc-jp",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartMixedUtf8Over7bit(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_mixed_utf-8_over_7bit.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_japanese_multipart_mixed_utf-8_over_7bit.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartMixedUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_mixed_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_japanese_multipart_mixed_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartMixedUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_mixed_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_japanese_multipart_mixed_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartMixedIso2022jpOver7bit(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_mixed_iso-2022-jp_over_7bit.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-2022-jp",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_japanese_multipart_mixed_iso-2022-jp_over_7bit.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-2022-jp",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartMixedIso2022jpOverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_mixed_iso-2022-jp_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-2022-jp",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_japanese_multipart_mixed_iso-2022-jp_over_base64.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-2022-jp",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartMixedIso2022jpOverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_mixed_iso-2022-jp_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-2022-jp",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_japanese_multipart_mixed_iso-2022-jp_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-2022-jp",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartMixedEucjpOverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_mixed_euc-jp_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "euc-jp",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_japanese_multipart_mixed_euc-jp_over_base64.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "euc-jp",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartMixedEucjpOverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_mixed_euc-jp_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "euc-jp",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_japanese_multipart_mixed_euc-jp_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "euc-jp",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				EnrichedText: `<bold>è‰²ã¯åŒ‚ãˆã©</bold>
<italic>æ•£ã‚Šã¬ã‚‹ã‚’</italic>
<fixed>æˆ‘ãŒä¸–èª°ãž</fixed>
<underline>å¸¸ãªã‚‰ã‚“</underline>
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				HTML: `<html>
<div dir="ltr">
<p>è‰²ã¯åŒ‚ãˆã©<br />
æ•£ã‚Šã¬ã‚‹ã‚’<br />
æˆ‘ãŒä¸–èª°ãž<br />
å¸¸ãªã‚‰ã‚“<br />
æœ‰ç‚ºã®å¥¥å±±<br />
ä»Šæ—¥è¶Šãˆã¦<br />
æµ…ãå¤¢è¦‹ã˜<br />
é…”ã„ã‚‚ã›ãšã€‚</p>

<p>Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.</p>

<p>ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚</p>

<p>å¤©åœ°æ˜Ÿç©º<br />
å±±å·å³°è°·<br />
é›²éœ§å®¤è‹”<br />
äººçŠ¬ä¸Šæœ«<br />
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ<br />
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚</p>

<p>ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartSignedUtf8Over7bit(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_signed_utf-8_over_7bit.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "utf-8",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartSignedUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_signed_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "utf-8",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartSignedUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_signed_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "utf-8",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartSignedIso2022jpOver7bit(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_signed_iso-2022-jp_over_7bit.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "iso-2022-jp",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartSignedIso2022jpOverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_signed_iso-2022-jp_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "iso-2022-jp",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartSignedIso2022jpOverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_signed_iso-2022-jp_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "iso-2022-jp",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartSignedEucjpOverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_signed_euc-jp_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "euc-jp",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailJapaneseMultipartSignedEucjpOverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Tokyo")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_japanese_multipart_signed_euc-jp_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test ã„ã‚ã¯æ­Œ",
					ReplyTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.com",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
							Address: "alice.yuubin@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "éƒµä¾¿ã‚¢ãƒªã‚¹",
						Address: "alice.yuubin@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒœãƒ–",
							Address: "bob.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚­ãƒ£ãƒ­ãƒ«",
							Address: "carol.yuubin@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ€ãƒ³",
							Address: "dan.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚¤ãƒ¼ãƒ–",
							Address: "eve.yubin@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "éƒµä¾¿ãƒ•ãƒ©ãƒ³ã‚¯",
							Address: "frank.yuubin@example.net",
						},
						{
							Name:    "éƒµä¾¿ã‚°ãƒ¬ã‚¤ã‚¹",
							Address: "grace.yubin@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "euc-jp",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `è‰²ã¯åŒ‚ãˆã©
æ•£ã‚Šã¬ã‚‹ã‚’
æˆ‘ãŒä¸–èª°ãž
å¸¸ãªã‚‰ã‚“
æœ‰ç‚ºã®å¥¥å±±
ä»Šæ—¥è¶Šãˆã¦
æµ…ãå¤¢è¦‹ã˜
é…”ã„ã‚‚ã›ãšã€‚

Iro wa nioedo / Chirinuru o / Wa ga yo tare zo / Tsune naran / Ui no okuyama / Kyo koete Asaki yume miji / Yoi mo sezu.

ã¨ã‚Šãªãã“ã‚‘ã™ã‚†ã‚ã•ã¾ã›ã¿ã‚ˆã‚ã‘ã‚ãŸã‚‹ã²ã‚“ã‹ã—ã‚’ãã‚‰ã„ã‚ã¯ãˆã¦ãŠãã¤ã¸ã«ã»ãµã­ã‚€ã‚Œã‚ã¬ã‚‚ã‚„ã®ã†ã¡ã€‚

å¤©åœ°æ˜Ÿç©º
å±±å·å³°è°·
é›²éœ§å®¤è‹”
äººçŠ¬ä¸Šæœ«
ç¡«é»„çŒ¿ç”Ÿãµç‚ºã‚ˆ
æ¦Žã®æžã‚’é¦´ã‚Œå±…ã¦ã€‚

ç”°å±…ã«å‡ºã§èœæ‘˜ã‚€ã‚ã‚Œã‚’ãžå›å¬ã™ã¨æ±‚é£Ÿã‚Šè¿½ã²ã‚†ãå±±åŸŽã®æ‰“é…”ã¸ã‚‹å­ã‚‰è—»è‘‰å¹²ã›ã‚ˆãˆèˆŸç¹‹ã‘ã¬ã€‚`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailKoreanPlaintextUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Seoul")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_korean_plaintext_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test í•œêµ­ì–´ íŒ¬ê·¸ëž¨",
					ReplyTo: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.com",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.com",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.com",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.net",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.net",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.net",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailKoreanPlaintextUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Seoul")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_korean_plaintext_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test í•œêµ­ì–´ íŒ¬ê·¸ëž¨",
					ReplyTo: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.com",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.com",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.com",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.net",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.net",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.net",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailKoreanPlaintextEuckrOverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Seoul")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_korean_plaintext_euc-kr_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test í•œêµ­ì–´ íŒ¬ê·¸ëž¨",
					ReplyTo: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.com",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.com",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.com",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.net",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.net",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.net",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "euc-kr",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailKoreanPlaintextEuckrOverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Seoul")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_korean_plaintext_euc-kr_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test í•œêµ­ì–´ íŒ¬ê·¸ëž¨",
					ReplyTo: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.com",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.com",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.com",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.net",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.net",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.net",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "euc-kr",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailKoreanMultipartRelatedUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Seoul")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_korean_multipart_related_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test í•œêµ­ì–´ íŒ¬ê·¸ëž¨",
					ReplyTo: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.com",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.com",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.com",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.net",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.net",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.net",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text:         `í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				EnrichedText: `<bold>í‚¤ìŠ¤ì˜</bold> <italic>ê³ ìœ ì¡°ê±´ì€</italic> <fixed>ìž…ìˆ ë¼ë¦¬</fixed> <underline>ë§Œë‚˜ì•¼</underline> í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				HTML: `<html>
<div dir="ltr">
<p>í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailKoreanMultipartRelatedUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Seoul")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_korean_multipart_related_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test í•œêµ­ì–´ íŒ¬ê·¸ëž¨",
					ReplyTo: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.com",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.com",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.com",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.net",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.net",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.net",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text:         `í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				EnrichedText: `<bold>í‚¤ìŠ¤ì˜</bold> <italic>ê³ ìœ ì¡°ê±´ì€</italic> <fixed>ìž…ìˆ ë¼ë¦¬</fixed> <underline>ë§Œë‚˜ì•¼</underline> í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				HTML: `<html>
<div dir="ltr">
<p>í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailKoreanMultipartRelatedEuckrOverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Seoul")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_korean_multipart_related_euc-kr_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test í•œêµ­ì–´ íŒ¬ê·¸ëž¨",
					ReplyTo: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.com",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.com",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.com",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.net",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.net",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.net",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "euc-kr",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text:         `í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				EnrichedText: `<bold>í‚¤ìŠ¤ì˜</bold> <italic>ê³ ìœ ì¡°ê±´ì€</italic> <fixed>ìž…ìˆ ë¼ë¦¬</fixed> <underline>ë§Œë‚˜ì•¼</underline> í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				HTML: `<html>
<div dir="ltr">
<p>í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailKoreanMultipartRelatedEuckrOverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Seoul")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_korean_multipart_related_euc-kr_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test í•œêµ­ì–´ íŒ¬ê·¸ëž¨",
					ReplyTo: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.com",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.com",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.com",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.net",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.net",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.net",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "euc-kr",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text:         `í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				EnrichedText: `<bold>í‚¤ìŠ¤ì˜</bold> <italic>ê³ ìœ ì¡°ê±´ì€</italic> <fixed>ìž…ìˆ ë¼ë¦¬</fixed> <underline>ë§Œë‚˜ì•¼</underline> í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				HTML: `<html>
<div dir="ltr">
<p>í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailKoreanMultipartMixedUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Seoul")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_korean_multipart_mixed_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test í•œêµ­ì–´ íŒ¬ê·¸ëž¨",
					ReplyTo: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.com",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.com",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.com",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.net",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.net",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.net",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text:         `í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				EnrichedText: `<bold>í‚¤ìŠ¤ì˜</bold> <italic>ê³ ìœ ì¡°ê±´ì€</italic> <fixed>ìž…ìˆ ë¼ë¦¬</fixed> <underline>ë§Œë‚˜ì•¼</underline> í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				HTML: `<html>
<div dir="ltr">
<p>í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_korean_multipart_mixed_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test í•œêµ­ì–´ íŒ¬ê·¸ëž¨",
					ReplyTo: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.com",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.com",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.com",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.net",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.net",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.net",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text:         `í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				EnrichedText: `<bold>í‚¤ìŠ¤ì˜</bold> <italic>ê³ ìœ ì¡°ê±´ì€</italic> <fixed>ìž…ìˆ ë¼ë¦¬</fixed> <underline>ë§Œë‚˜ì•¼</underline> í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				HTML: `<html>
<div dir="ltr">
<p>í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailKoreanMultipartMixedUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Seoul")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_korean_multipart_mixed_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test í•œêµ­ì–´ íŒ¬ê·¸ëž¨",
					ReplyTo: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.com",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.com",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.com",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.net",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.net",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.net",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text:         `í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				EnrichedText: `<bold>í‚¤ìŠ¤ì˜</bold> <italic>ê³ ìœ ì¡°ê±´ì€</italic> <fixed>ìž…ìˆ ë¼ë¦¬</fixed> <underline>ë§Œë‚˜ì•¼</underline> í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				HTML: `<html>
<div dir="ltr">
<p>í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_korean_multipart_mixed_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test í•œêµ­ì–´ íŒ¬ê·¸ëž¨",
					ReplyTo: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.com",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.com",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.com",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.net",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.net",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.net",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text:         `í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				EnrichedText: `<bold>í‚¤ìŠ¤ì˜</bold> <italic>ê³ ìœ ì¡°ê±´ì€</italic> <fixed>ìž…ìˆ ë¼ë¦¬</fixed> <underline>ë§Œë‚˜ì•¼</underline> í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				HTML: `<html>
<div dir="ltr">
<p>í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailKoreanMultipartMixedEuckrOverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Seoul")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_korean_multipart_mixed_euc-kr_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test í•œêµ­ì–´ íŒ¬ê·¸ëž¨",
					ReplyTo: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.com",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.com",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.com",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.net",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.net",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.net",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "euc-kr",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text:         `í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				EnrichedText: `<bold>í‚¤ìŠ¤ì˜</bold> <italic>ê³ ìœ ì¡°ê±´ì€</italic> <fixed>ìž…ìˆ ë¼ë¦¬</fixed> <underline>ë§Œë‚˜ì•¼</underline> í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				HTML: `<html>
<div dir="ltr">
<p>í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_korean_multipart_mixed_euc-kr_over_base64.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test í•œêµ­ì–´ íŒ¬ê·¸ëž¨",
					ReplyTo: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.com",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.com",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.com",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.net",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.net",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.net",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "euc-kr",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text:         `í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				EnrichedText: `<bold>í‚¤ìŠ¤ì˜</bold> <italic>ê³ ìœ ì¡°ê±´ì€</italic> <fixed>ìž…ìˆ ë¼ë¦¬</fixed> <underline>ë§Œë‚˜ì•¼</underline> í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				HTML: `<html>
<div dir="ltr">
<p>í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailKoreanMultipartMixedEuckrOverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Seoul")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_korean_multipart_mixed_euc-kr_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test í•œêµ­ì–´ íŒ¬ê·¸ëž¨",
					ReplyTo: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.com",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.com",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.com",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.net",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.net",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.net",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "euc-kr",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text:         `í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				EnrichedText: `<bold>í‚¤ìŠ¤ì˜</bold> <italic>ê³ ìœ ì¡°ê±´ì€</italic> <fixed>ìž…ìˆ ë¼ë¦¬</fixed> <underline>ë§Œë‚˜ì•¼</underline> í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				HTML: `<html>
<div dir="ltr">
<p>í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_korean_multipart_mixed_euc-kr_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test í•œêµ­ì–´ íŒ¬ê·¸ëž¨",
					ReplyTo: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.com",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.com",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.com",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.net",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.net",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.net",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "euc-kr",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text:         `í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				EnrichedText: `<bold>í‚¤ìŠ¤ì˜</bold> <italic>ê³ ìœ ì¡°ê±´ì€</italic> <fixed>ìž…ìˆ ë¼ë¦¬</fixed> <underline>ë§Œë‚˜ì•¼</underline> í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				HTML: `<html>
<div dir="ltr">
<p>í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailKoreanMultipartSignedUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Seoul")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_korean_multipart_signed_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test í•œêµ­ì–´ íŒ¬ê·¸ëž¨",
					ReplyTo: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.com",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.com",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.com",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.net",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.net",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.net",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "utf-8",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailKoreanMultipartSignedUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Seoul")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_korean_multipart_signed_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test í•œêµ­ì–´ íŒ¬ê·¸ëž¨",
					ReplyTo: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.com",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.com",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.com",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.net",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.net",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.net",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "utf-8",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailKoreanMultipartSignedEuckrOverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Seoul")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_korean_multipart_signed_euc-kr_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test í•œêµ­ì–´ íŒ¬ê·¸ëž¨",
					ReplyTo: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.com",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.com",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.com",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.net",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.net",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.net",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "euc-kr",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailKoreanMultipartSignedEuckrOverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Seoul")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_korean_multipart_signed_euc-kr_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test í•œêµ­ì–´ íŒ¬ê·¸ëž¨",
					ReplyTo: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.com",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.com",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.com",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.net",
						},
						{
							Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
							Address: "alice.bonaeneunsalam@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "ì•¨ë¦¬ìŠ¤ ë³´ë‚´ëŠ”ì‚¬ëžŒ",
						Address: "alice.bonaeneunsalam@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "ë°¥ ìˆ˜ì‹ ìž",
							Address: "bob.susinja@example.net",
						},
						{
							Name:    "ìºë¡¤ ìˆ˜ì‹ ìž",
							Address: "carol.susinja@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "ëŒ„ ìˆ˜ì‹ ìž",
							Address: "dan.susinja@example.net",
						},
						{
							Name:    "ì´ë¸Œ ìˆ˜ì‹ ìž",
							Address: "eve.susinja@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "í”„ëž­í¬ ìˆ˜ì‹ ìž",
							Address: "frank.susinja@example.net",
						},
						{
							Name:    "ê·¸ë ˆì´ìŠ¤ ìˆ˜ì‹ ìž",
							Address: "grace.susinja@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "euc-kr",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `í‚¤ìŠ¤ì˜ ê³ ìœ ì¡°ê±´ì€ ìž…ìˆ ë¼ë¦¬ ë§Œë‚˜ì•¼ í•˜ê³  íŠ¹ë³„í•œ ê¸°ìˆ ì€ í•„ìš”ì¹˜ ì•Šë‹¤.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailPolishPlaintextUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Warsaw")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_polish_plaintext_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Polskie pangramy",
					ReplyTo: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!
PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!
MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.
Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailPolishPlaintextUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Warsaw")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_polish_plaintext_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Polskie pangramy",
					ReplyTo: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!
PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!
MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.
Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailPolishPlaintextIso88592OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Warsaw")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_polish_plaintext_iso-8859-2_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Polskie pangramy",
					ReplyTo: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "iso-8859-2",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!
PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!
MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.
Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailPolishPlaintextIso88592OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Warsaw")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_polish_plaintext_iso-8859-2_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Polskie pangramy",
					ReplyTo: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "iso-8859-2",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!
PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!
MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.
Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailPolishMultipartRelatedUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Warsaw")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_polish_multipart_related_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Polskie pangramy",
					ReplyTo: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!
PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!
MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.
Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				EnrichedText: `<bold>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</bold>
<italic>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</italic>
<fixed>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</fixed>
<underline>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</underline>
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				HTML: `<html>
<div dir="ltr">
<p>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</p>
<p>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</p>
<p>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</p>
<p>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</p>
<p>PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.</p>
<p>DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!</p>
<p>PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!</p>
<p>ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailPolishMultipartRelatedUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Warsaw")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_polish_multipart_related_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Polskie pangramy",
					ReplyTo: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!
PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!
MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.
Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				EnrichedText: `<bold>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</bold>
<italic>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</italic>
<fixed>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</fixed>
<underline>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</underline>
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				HTML: `<html>
<div dir="ltr">
<p>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</p>
<p>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</p>
<p>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</p>
<p>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</p>
<p>PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.</p>
<p>DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!</p>
<p>PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!</p>
<p>ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailPolishMultipartRelatedIso88592OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Warsaw")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_polish_multipart_related_iso-8859-2_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Polskie pangramy",
					ReplyTo: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "iso-8859-2",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!
PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!
MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.
Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				EnrichedText: `<bold>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</bold>
<italic>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</italic>
<fixed>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</fixed>
<underline>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</underline>
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				HTML: `<html>
<div dir="ltr">
<p>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</p>
<p>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</p>
<p>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</p>
<p>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</p>
<p>PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.</p>
<p>DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!</p>
<p>PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!</p>
<p>ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailPolishMultipartRelatedIso88592OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Warsaw")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_polish_multipart_related_iso-8859-2_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Polskie pangramy",
					ReplyTo: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "iso-8859-2",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!
PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!
MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.
Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				EnrichedText: `<bold>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</bold>
<italic>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</italic>
<fixed>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</fixed>
<underline>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</underline>
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				HTML: `<html>
<div dir="ltr">
<p>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</p>
<p>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</p>
<p>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</p>
<p>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</p>
<p>PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.</p>
<p>DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!</p>
<p>PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!</p>
<p>ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailPolishMultipartMixedUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Warsaw")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_polish_multipart_mixed_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Polskie pangramy",
					ReplyTo: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!
PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!
MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.
Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				EnrichedText: `<bold>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</bold>
<italic>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</italic>
<fixed>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</fixed>
<underline>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</underline>
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				HTML: `<html>
<div dir="ltr">
<p>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</p>
<p>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</p>
<p>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</p>
<p>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</p>
<p>PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.</p>
<p>DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!</p>
<p>PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!</p>
<p>ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_polish_multipart_mixed_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Polskie pangramy",
					ReplyTo: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!
PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!
MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.
Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				EnrichedText: `<bold>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</bold>
<italic>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</italic>
<fixed>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</fixed>
<underline>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</underline>
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				HTML: `<html>
<div dir="ltr">
<p>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</p>
<p>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</p>
<p>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</p>
<p>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</p>
<p>PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.</p>
<p>DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!</p>
<p>PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!</p>
<p>ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailPolishMultipartMixedUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Warsaw")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_polish_multipart_mixed_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Polskie pangramy",
					ReplyTo: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!
PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!
MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.
Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				EnrichedText: `<bold>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</bold>
<italic>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</italic>
<fixed>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</fixed>
<underline>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</underline>
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				HTML: `<html>
<div dir="ltr">
<p>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</p>
<p>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</p>
<p>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</p>
<p>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</p>
<p>PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.</p>
<p>DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!</p>
<p>PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!</p>
<p>ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_polish_multipart_mixed_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Polskie pangramy",
					ReplyTo: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "utf-8",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!
PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!
MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.
Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				EnrichedText: `<bold>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</bold>
<italic>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</italic>
<fixed>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</fixed>
<underline>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</underline>
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				HTML: `<html>
<div dir="ltr">
<p>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</p>
<p>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</p>
<p>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</p>
<p>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</p>
<p>PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.</p>
<p>DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!</p>
<p>PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!</p>
<p>ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailPolishMultipartMixedIso88592OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Warsaw")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_polish_multipart_mixed_iso-8859-2_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Polskie pangramy",
					ReplyTo: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-8859-2",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!
PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!
MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.
Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				EnrichedText: `<bold>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</bold>
<italic>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</italic>
<fixed>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</fixed>
<underline>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</underline>
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				HTML: `<html>
<div dir="ltr">
<p>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</p>
<p>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</p>
<p>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</p>
<p>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</p>
<p>PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.</p>
<p>DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!</p>
<p>PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!</p>
<p>ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_polish_multipart_mixed_iso-8859-2_over_base64.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Polskie pangramy",
					ReplyTo: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-8859-2",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!
PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!
MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.
Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				EnrichedText: `<bold>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</bold>
<italic>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</italic>
<fixed>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</fixed>
<underline>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</underline>
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				HTML: `<html>
<div dir="ltr">
<p>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</p>
<p>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</p>
<p>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</p>
<p>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</p>
<p>PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.</p>
<p>DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!</p>
<p>PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!</p>
<p>ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailPolishMultipartMixedIso88592OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Warsaw")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_polish_multipart_mixed_iso-8859-2_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Polskie pangramy",
					ReplyTo: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-8859-2",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!
PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!
MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.
Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				EnrichedText: `<bold>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</bold>
<italic>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</italic>
<fixed>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</fixed>
<underline>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</underline>
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				HTML: `<html>
<div dir="ltr">
<p>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</p>
<p>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</p>
<p>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</p>
<p>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</p>
<p>PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.</p>
<p>DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!</p>
<p>PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!</p>
<p>ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_polish_multipart_mixed_iso-8859-2_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test Polskie pangramy",
					ReplyTo: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-8859-2",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!
PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!
MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.
Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				EnrichedText: `<bold>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</bold>
<italic>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</italic>
<fixed>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</fixed>
<underline>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</underline>
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				HTML: `<html>
<div dir="ltr">
<p>JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!</p>
<p>PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!</p>
<p>MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.</p>
<p>Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!</p>
<p>PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.</p>
<p>DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!</p>
<p>PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!</p>
<p>ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailPolishMultipartSignedUtf8OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Warsaw")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_polish_multipart_signed_utf-8_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test Polskie pangramy",
					ReplyTo: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "utf-8",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!
PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!
MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.
Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailPolishMultipartSignedUtf8OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Warsaw")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_polish_multipart_signed_utf-8_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test Polskie pangramy",
					ReplyTo: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "utf-8",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!
PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!
MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.
Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailPolishMultipartSignedIso88592OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Warsaw")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_polish_multipart_signed_iso-8859-2_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test Polskie pangramy",
					ReplyTo: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "iso-8859-2",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!
PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!
MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.
Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailPolishMultipartSignedIso88592OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Europe/Warsaw")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_polish_multipart_signed_iso-8859-2_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test Polskie pangramy",
					ReplyTo: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.com",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.net",
						},
						{
							Name:    "NadajÄ…ca, Alicja",
							Address: "alicja.nadajaca@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "NadajÄ…ca, Alicja",
						Address: "alicja.nadajaca@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Bob",
							Address: "bob.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Karolina",
							Address: "karolina.odbierajaca@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Daniel",
							Address: "daniel.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, Ewa",
							Address: "ewa.odbierajaca@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "OdbierajÄ…cy, Franek",
							Address: "franek.odbierajacy@example.net",
						},
						{
							Name:    "OdbierajÄ…ca, GraÅ¼yna",
							Address: "grazyna.odbierajaca@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "iso-8859-2",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `JeÅ¼u klÄ…tw, spÅ‚Ã³dÅº Finom czÄ™Å›Ä‡ gry haÅ„b!
PÃ³jdÅºÅ¼e, kiÅ„ tÄ™ chmurnoÅ›Ä‡ w gÅ‚Ä…b flaszy!
MÄ™Å¼ny bÄ…dÅº chroÅ„ puÅ‚k twÃ³j i szeÅ›Ä‡ flag.
Filmuj rzeÅº Å¼Ä…daÅ„, poÅ›Ä‡, gnÄ™b chÅ‚ystkÃ³w!
PchnÄ…Ä‡ w tÄ™ Å‚Ã³dÅº jeÅ¼a lub oÅ›m skrzyÅ„ fig.
DoÅ›Ä‡ grÃ³Åºb fuzjÄ…, klnÄ™, pych i maÅ‚Å¼eÅ„stw!
PÃ³jdÅº w loch zbiÄ‡ maÅ‚Å¼eÅ„skÄ… gÄ™Å› futryn!
ChwyÄ‡ maÅ‚Å¼onkÄ™, strÃ³j bÄ…dÅº pleÅ›Å„ z fugi.`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiPlaintextIso885911OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_plaintext_iso-8859-11_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "iso-8859-11",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiPlaintextIso885911OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_plaintext_iso-8859-11_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "iso-8859-11",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiPlaintextWindows874OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_plaintext_windows-874_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "windows-874",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiPlaintextWindows874OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_plaintext_windows-874_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "windows-874",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiPlaintextTis620OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_plaintext_tis-620_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "tis-620",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiPlaintextTis620OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_plaintext_tis-620_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "text/plain",
						Params: map[string]string{
							"charset": "tis-620",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiMultipartRelatedIso885911OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_multipart_related_iso-8859-11_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "iso-8859-11",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				EnrichedText: `<bold>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸²</bold> <italic>à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™</italic> <fixed>à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£</fixed> <underline>à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£</underline> à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				HTML: `<html>
<div dir="ltr">
<p>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯</p>

<p>à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiMultipartRelatedIso885911OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_multipart_related_iso-8859-11_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "iso-8859-11",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				EnrichedText: `<bold>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸²</bold> <italic>à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™</italic> <fixed>à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£</fixed> <underline>à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£</underline> à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				HTML: `<html>
<div dir="ltr">
<p>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯</p>

<p>à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiMultipartRelatedWindows874OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_multipart_related_windows-874_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "windows-874",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				EnrichedText: `<bold>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸²</bold> <italic>à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™</italic> <fixed>à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£</fixed> <underline>à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£</underline> à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				HTML: `<html>
<div dir="ltr">
<p>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯</p>

<p>à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiMultipartRelatedWindows874OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_multipart_related_windows-874_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "windows-874",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				EnrichedText: `<bold>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸²</bold> <italic>à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™</italic> <fixed>à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£</fixed> <underline>à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£</underline> à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				HTML: `<html>
<div dir="ltr">
<p>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯</p>

<p>à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiMultipartRelatedTis620OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_multipart_related_tis-620_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "tis-620",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				EnrichedText: `<bold>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸²</bold> <italic>à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™</italic> <fixed>à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£</fixed> <underline>à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£</underline> à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				HTML: `<html>
<div dir="ltr">
<p>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯</p>

<p>à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiMultipartRelatedTis620OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_multipart_related_tis-620_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/related",
						Params: map[string]string{
							"boundary": "RelatedBoundaryString",
							"charset":  "tis-620",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				EnrichedText: `<bold>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸²</bold> <italic>à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™</italic> <fixed>à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£</fixed> <underline>à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£</underline> à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				HTML: `<html>
<div dir="ltr">
<p>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯</p>

<p>à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiMultipartMixedIso885911OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_multipart_mixed_iso-8859-11_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-8859-11",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				EnrichedText: `<bold>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸²</bold> <italic>à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™</italic> <fixed>à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£</fixed> <underline>à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£</underline> à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				HTML: `<html>
<div dir="ltr">
<p>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯</p>

<p>à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_thai_multipart_mixed_iso-8859-11_over_base64.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-8859-11",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				EnrichedText: `<bold>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸²</bold> <italic>à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™</italic> <fixed>à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£</fixed> <underline>à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£</underline> à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				HTML: `<html>
<div dir="ltr">
<p>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯</p>

<p>à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiMultipartMixedIso885911OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_multipart_mixed_iso-8859-11_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-8859-11",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				EnrichedText: `<bold>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸²</bold> <italic>à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™</italic> <fixed>à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£</fixed> <underline>à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£</underline> à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				HTML: `<html>
<div dir="ltr">
<p>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯</p>

<p>à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_thai_multipart_mixed_iso-8859-11_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "iso-8859-11",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				EnrichedText: `<bold>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸²</bold> <italic>à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™</italic> <fixed>à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£</fixed> <underline>à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£</underline> à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				HTML: `<html>
<div dir="ltr">
<p>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯</p>

<p>à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiMultipartMixedWindows874OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_multipart_mixed_windows-874_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "windows-874",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				EnrichedText: `<bold>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸²</bold> <italic>à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™</italic> <fixed>à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£</fixed> <underline>à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£</underline> à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				HTML: `<html>
<div dir="ltr">
<p>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯</p>

<p>à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_thai_multipart_mixed_windows-874_over_base64.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "windows-874",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				EnrichedText: `<bold>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸²</bold> <italic>à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™</italic> <fixed>à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£</fixed> <underline>à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£</underline> à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				HTML: `<html>
<div dir="ltr">
<p>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯</p>

<p>à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiMultipartMixedWindows874OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_multipart_mixed_windows-874_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "windows-874",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				EnrichedText: `<bold>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸²</bold> <italic>à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™</italic> <fixed>à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£</fixed> <underline>à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£</underline> à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				HTML: `<html>
<div dir="ltr">
<p>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯</p>

<p>à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_thai_multipart_mixed_windows-874_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "windows-874",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				EnrichedText: `<bold>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸²</bold> <italic>à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™</italic> <fixed>à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£</fixed> <underline>à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£</underline> à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				HTML: `<html>
<div dir="ltr">
<p>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯</p>

<p>à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiMultipartMixedTis620OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_multipart_mixed_tis-620_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "tis-620",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				EnrichedText: `<bold>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸²</bold> <italic>à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™</italic> <fixed>à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£</fixed> <underline>à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£</underline> à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				HTML: `<html>
<div dir="ltr">
<p>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯</p>

<p>à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_thai_multipart_mixed_tis-620_over_base64.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "tis-620",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				EnrichedText: `<bold>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸²</bold> <italic>à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™</italic> <fixed>à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£</fixed> <underline>à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£</underline> à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				HTML: `<html>
<div dir="ltr">
<p>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯</p>

<p>à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiMultipartMixedTis620OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_multipart_mixed_tis-620_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "tis-620",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				EnrichedText: `<bold>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸²</bold> <italic>à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™</italic> <fixed>à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£</fixed> <underline>à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£</underline> à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				HTML: `<html>
<div dir="ltr">
<p>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯</p>

<p>à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-without-disposition.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
					{
						ContentID: "inline-jpg-image.jpg@example.com",
						ContentType: letters.ContentTypeHeader{
							ContentType: "image/jpeg",
							Params: map[string]string{
								"name": "inline-jpg-image-name.jpg",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionInline,
							Params: map[string]string{
								"filename": "inline-jpg-image-filename.jpg",
							},
						},
						Data: []byte{
							255, 216, 255, 219, 0, 67, 0, 3, 2, 2, 2, 2, 2, 3, 2, 2, 2, 3, 3, 3, 3, 4,
							6, 4, 4, 4, 4, 4, 8, 6, 6, 5, 6, 9, 8, 10, 10, 9, 8, 9, 9, 10, 12, 15, 12, 10, 11, 14, 11, 9, 9,
							13, 17, 13, 14, 15, 16, 16, 17, 16, 10, 12, 18, 19, 18, 16, 19, 15, 16, 16, 16, 255, 201, 0, 11, 8,
							0, 1, 0, 1, 1, 1, 17, 0, 255, 204, 0, 6, 0, 16, 16, 5, 255, 218, 0, 8, 1, 1, 0, 0, 63, 0, 210, 207,
							32, 255, 217,
						},
					},
				},
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-name.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-pdf-filename.pdf",
							},
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pdf",
							Params: map[string]string{
								"name": "attached-pdf-without-disposition.pdf",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: "",
							Params:             map[string]string(nil),
						},
						Data: []byte{
							37, 80, 68, 70, 45, 49, 46, 13, 116, 114, 97, 105, 108, 101, 114, 60, 60,
							47, 82, 111, 111, 116, 60, 60, 47, 80, 97, 103, 101, 115, 60, 60, 47, 75, 105, 100, 115, 91, 60,
							60, 47, 77, 101, 100, 105, 97, 66, 111, 120, 91, 48, 32, 48, 32, 51, 32, 51, 93, 62, 62, 93, 62,
							62, 62, 62, 62, 62,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/json",
							Params: map[string]string{
								"name": "attached-json-name.json",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-json-filename.json",
							},
						},
						Data: []byte{123, 34, 102, 111, 111, 34, 58, 34, 98, 97, 114, 34, 125},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/html",
							Params: map[string]string{
								"name": "attached-text-html-name.html",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-html-filename.html",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 104, 116, 109, 108, 32, 99, 111, 110, 116, 101, 110, 116, 32, 97,
							115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 104, 116, 109, 108, 32, 102,
							105, 108, 101, 46,
						},
					},
				},
			},
		},
		{
			name:     "TXTFileOnlyParser",
			filepath: "tests/test_thai_multipart_mixed_tis-620_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(
				letters.WithFileFilter(
					func(cth letters.ContentTypeHeader) bool {
						return strings.HasSuffix(
							strings.ToLower(cth.Params["name"]), ".txt",
						)
					},
				),
			),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/mixed",
						Params: map[string]string{
							"boundary": "MixedBoundaryString",
							"charset":  "tis-620",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				EnrichedText: `<bold>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸²</bold> <italic>à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™</italic> <fixed>à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£</fixed> <underline>à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£</underline> à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				HTML: `<html>
<div dir="ltr">
<p>à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯</p>

<p>à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´</p>
</div>
</html>`,
				InlineFiles: []letters.InlineFile(nil),
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "text/plain",
							Params: map[string]string{
								"name": "attached-text-plain-name.txt",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "attached-text-plain-filename.txt",
							},
						},
						Data: []byte{
							84, 101, 120, 116, 47, 112, 108, 97, 105, 110, 32, 99, 111, 110, 116, 101, 110, 116, 32,
							97, 115, 32, 97, 110, 32, 97, 116, 116, 97, 99, 104, 101, 100, 32, 46, 116, 120, 116, 32, 102, 105,
							108, 101, 46,
						},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiMultipartSignedIso885911OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_multipart_signed_iso-8859-11_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "iso-8859-11",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiMultipartSignedIso885911OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_multipart_signed_iso-8859-11_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "iso-8859-11",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiMultipartSignedWindows874OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_multipart_signed_windows-874_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "windows-874",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiMultipartSignedWindows874OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_multipart_signed_windows-874_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "windows-874",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiMultipartSignedTis620OverBase64(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_multipart_signed_tis-620_over_base64.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "tis-620",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}

func TestParseEmailThaiMultipartSignedTis620OverQuotedprintable(t *testing.T) {
	t.Parallel()

	tz, _ := time.LoadLocation("Asia/Bangkok")
	expectedDate, _ := time.Parse(
		time.RFC1123Z+" (MST)",
		time.Date(2019, time.April, 1, 7, 55, 0, 0, tz).Format(time.RFC1123Z+" (MST)"),
	)

	tcs := []emailTestCase{
		{
			name:        "DefaultParser",
			filepath:    "tests/test_thai_multipart_signed_tis-620_over_quoted-printable.txt",
			emailParser: letters.NewEmailParser(),
			expectedEmail: letters.Email{
				Headers: letters.Headers{
					Date:    expectedDate,
					Subject: "ðŸ“§ Signed Test à¹à¸žà¸™à¹à¸à¸£à¸¡à¸ à¸²à¸©à¸²à¹„à¸—à¸¢",
					ReplyTo: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					Sender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.com",
					},
					From: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
					},
					To: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.com",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.com",
						},
					},
					Cc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.com",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.com",
						},
					},
					Bcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.com",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.com",
						},
					},
					MessageID:  "Message-Id-1@example.com",
					InReplyTo:  []letters.MessageId{"Message-Id-0@example.com"},
					References: []letters.MessageId{"Message-Id-0@example.com"},
					Comments:   "Message Header Comment",
					Keywords:   []string{"Keyword 1", "Keyword 2"},
					ResentDate: expectedDate,
					ResentFrom: []*mail.Address{
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.net",
						},
						{
							Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
							Address: "alis.phusngcdhmay@example.com",
						},
					},
					ResentSender: &mail.Address{
						Name:    "à¸­à¸¥à¸´à¸‹ à¸œà¸¹à¹‰à¸ªà¹ˆà¸‡à¸ˆà¸”à¸«à¸¡à¸²à¸¢",
						Address: "alis.phusngcdhmay@example.net",
					},
					ResentTo: []*mail.Address{
						{
							Name:    "à¸šà¹Šà¸­à¸š à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "bob.phurab@example.net",
						},
						{
							Name:    "à¸„à¸²à¹‚à¸£à¸¥ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "carol.phurab@example.net",
						},
					},
					ResentCc: []*mail.Address{
						{
							Name:    "à¹à¸”à¸™ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "dan.phurab@example.net",
						},
						{
							Name:    "à¸­à¸µà¸Ÿ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "eve.phurab@example.net",
						},
					},
					ResentBcc: []*mail.Address{
						{
							Name:    "à¹à¸Ÿà¸£à¸‡à¸„à¹Œ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "frank.phurab@example.net",
						},
						{
							Name:    "à¹€à¸à¸£à¸‹ à¸œà¸¹à¹‰à¸£à¸±à¸š",
							Address: "grace.phurab@example.net",
						},
					},
					ResentMessageID: "Message-Id-1@example.net",
					ContentType: letters.ContentTypeHeader{
						ContentType: "multipart/signed",
						Params: map[string]string{
							"boundary": "SignedBoundaryString",
							"charset":  "tis-620",
							"micalg":   "sha1",
							"protocol": "application/pkcs7-signature",
						},
					},
					ExtraHeaders: map[string][]string{
						"X-Clacks-Overhead": {"GNU Terry Pratchett"},
						"X-Script/function/\t !\"#$%&'()*+,-./;<=>?@[\\]^_`{|}~": {
							"TEST VALUE 1\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
							"TEST VALUE 2\t !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_` abcdefghijklmnopqrstuvwxyz{|}~",
						},
					},
				},
				Text: `à¹€à¸›à¹‡à¸™à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸ªà¸¸à¸”à¸›à¸£à¸°à¹€à¸ªà¸£à¸´à¸à¹€à¸¥à¸´à¸¨à¸„à¸¸à¸“à¸„à¹ˆà¸² à¸à¸§à¹ˆà¸²à¸šà¸£à¸£à¸”à¸²à¸à¸¹à¸‡à¸ªà¸±à¸•à¸§à¹Œà¹€à¸”à¸£à¸±à¸ˆà¸‰à¸²à¸™ à¸ˆà¸‡à¸à¹ˆà¸²à¸Ÿà¸±à¸™à¸žà¸±à¸’à¸™à¸²à¸§à¸´à¸Šà¸²à¸à¸²à¸£ à¸­à¸¢à¹ˆà¸²à¸¥à¹‰à¸²à¸‡à¸œà¸¥à¸²à¸à¸¤à¹…à¹€à¸‚à¹ˆà¸™à¸†à¹ˆà¸²à¸šà¸µà¸‘à¸²à¹ƒà¸„à¸£ à¹„à¸¡à¹ˆà¸–à¸·à¸­à¹‚à¸—à¸©à¹‚à¸à¸£à¸˜à¹à¸Šà¹ˆà¸‡à¸‹à¸±à¸”à¸®à¸¶à¸”à¸®à¸±à¸”à¸”à¹ˆà¸² à¸«à¸±à¸”à¸­à¸ à¸±à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸µà¸¬à¸²à¸­à¸±à¸Šà¸Œà¸²à¸ªà¸±à¸¢ à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸›à¸£à¸°à¸žà¸¤à¸•à¸´à¸à¸Žà¸à¸³à¸«à¸™à¸”à¹ƒà¸ˆ à¸žà¸¹à¸”à¸ˆà¸²à¹ƒà¸«à¹‰à¸ˆà¹Šà¸°à¹† à¸ˆà¹‹à¸²à¹† à¸™à¹ˆà¸²à¸Ÿà¸±à¸‡à¹€à¸­à¸¢à¸¯

à¸™à¸²à¸¢à¸ªà¸±à¸‡à¸†à¸ à¸±à¸“à¸‘à¹Œ à¹€à¸®à¸‡à¸žà¸´à¸—à¸±à¸à¸©à¹Œà¸à¸±à¹ˆà¸‡ à¸œà¸¹à¹‰à¹€à¸’à¹ˆà¸²à¸‹à¸¶à¹ˆà¸‡à¸¡à¸µà¸­à¸²à¸Šà¸µà¸žà¹€à¸›à¹‡à¸™à¸…à¸™à¸‚à¸²à¸¢à¸ƒà¸§à¸” à¸–à¸¹à¸à¸•à¸³à¸£à¸§à¸ˆà¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸ˆà¸±à¸šà¸Ÿà¹‰à¸­à¸‡à¸¨à¸²à¸¥ à¸à¸²à¸™à¸¥à¸±à¸à¸™à¸²à¸¬à¸´à¸à¸²à¸„à¸¸à¸“à¸«à¸à¸´à¸‡à¸‰à¸±à¸•à¸£à¸Šà¸Žà¸² à¸Œà¸²à¸™à¸ªà¸¡à¸²à¸˜à¸´`,
				AttachedFiles: []letters.AttachedFile{
					{
						ContentType: letters.ContentTypeHeader{
							ContentType: "application/pkcs7-signature",
							Params: map[string]string{
								"name": "smime.p7s",
							},
						},
						ContentDisposition: letters.ContentDispositionHeader{
							ContentDisposition: letters.ContentDispositionAttachment,
							Params: map[string]string{
								"filename": "smime.p7s",
							},
						},
						Data: []byte{130, 28, 135, 132, 117, 46, 142, 18, 97, 140, 126, 251, 159, 193, 199, 25, 58, 223, 189, 185, 227, 239, 158, 173, 108, 31, 71, 27, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 235, 133, 80, 165, 252, 133, 227, 174, 198, 132, 129, 159, 29, 246, 19, 234, 49, 251, 238, 127, 7, 28, 104, 33, 200, 120, 71, 82, 232, 225, 38, 30, 249, 234, 214, 193, 244, 113, 147, 173, 251, 219, 158, 57, 252, 28, 113, 147, 173, 251, 225, 38, 24, 199, 239, 190, 173, 108, 31, 71, 27, 133, 80, 110, 120, 251, 231, 174, 198, 132, 129, 159, 29, 246, 19, 234, 8, 114, 30, 17, 212, 186, 58, 95, 200, 94, 59, 26, 18, 6, 124, 119, 216, 79, 174, 21, 65, 185, 227, 239, 158},
					},
				},
			},
		},
	}

	testEmailCases(t, tcs)
}
